---
title: 'Unit 5 Case Study: Exposure and Influence'
subtitle: "ECI 589 Social Network Analysis and Education"
author: "Dr. Shaun Kellogg"
date: "`r format(Sys.Date(),'%B %e, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: 4
    toc_float: yes
    code_folding: show
editor_options:
  markdown:
    wrap: 72
bibliography: lit/references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## 1. PREPARE

In Unit 5 we explore the process of network influence, which is the flip
side of network selection processes that we examined in our previous
case study. Both of these processes are commonly the focus of
statistical analyses of networks. Selection and influence do not
interact independently and often affect each other reciprocally (Xu,
Frank, & Penuel, 2018).

Let's first quickly define these two processes:

-   **Selection**: the process of choosing relationships

-   **Influence**: the process of how our social relationships affect
    behavior

### 1a. Research Question

In Unit 5, we will briefly examine a hypothetical example of peer
influence on attitudes towards STEM careers among a small group of
friends. Specifically, we will try to answer the following question:

> Are student' attitudes towards careers in STEM influenced by the
> attitudes of their friends?

### 1b. Load Libraries

While selection and influence processes are complex, it is possible to
study them using data about people's relationships and behavior.
Happily, the use of these methods has expanded along with R. In fact,
long-standing R packages have become some of the best tools for studying
social networks. Additionally, while there are many nuances to studying
selection and influence, these are models that can be carried out with
relatively simple modeling techniques like linear regression.

#### ðŸ‘‰ Your Turn â¤µ

Load the the following packages that will be using for our analysis of
network influence:

-   tidyverse
-   tidygraph
-   ggraph
-   moderndive

```{r load-libraries}
# YOUR CODE HERE
library(tidyverse)
library(tidygraph)
library(ggraph)
library(moderndive)
```

------------------------------------------------------------------------

## 2. WRANGLE

To examine a hypothetical case of network selection, we'll create three
different data frames. These will include:

-   One **edgelist** that contains theÂ *nominator*Â andÂ *nominee*Â for a
    relationship. For example, if Stefanie says that JosÃ© is her friend,
    then Stefanie is the nominator and JosÃ© the nominee. Our edgelist
    will also contain variable indicating the weight, or strength, of
    their relation.

-   Two **nodelists** indicating the values of some behavior - an
    outcome - at two different time points. In our case, these values
    will represent a measure student's attitudes towards careers in
    STEM.

### 2a. Create an Edgelist

First let's create an edgelist with three variables for a nominator,
nominee, and strength of the relation. Run the following code to create
[tibble](https://tibble.tidyverse.org) -- a tidy table or data frame --
that contains information about each friendship dyad in our network with
a corresponding strength of "1":

```{r, create-edgelist}

student_edges <- tibble(nominator = c(2, 1, 3, 1, 2, 6, 3, 5, 6, 4, 3, 4), 
                    nominee = c(1, 2, 2, 3, 3, 3, 4, 4, 4, 5, 6, 6), 
                    relate = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1) ) 

student_edges
```

### 2a. Create Nodelists

Next, let's create a data frame, or tibble, that contains the nominee
and the values of a behavior at the first time point. For our
hypothetical example, our `time_1` variable represents a composite score
for each students' attitude towards STEM careers at the beginning of the
semester and measured on a scale of -3 (very negative) to 3 (very
positive)

```{r}
nominee_data <- tibble(nominee = c(1, 2, 3, 4, 5, 6), 
                time_1 = c(2.4, 2.6, 1.1, -0.5, -3, -1)
                )
```

We will use this data late in our modeling section create a new measure
called an "exposure term" that

#### ðŸ‘‰ Your Turn â¤µ

Create a third data frame called `data3` that produces the following
output at time point 2 collected after the project for each students'
attitude towards group work:

| nominator | time_1 | time_2 |
|-----------|--------|--------|
| 1         | 2.4    | 2      |
| 2         | 2.6    | 2      |
| 3         | 1.1    | 1      |
| 4         | -0.5   | -0.5   |
| 5         | -3     | -2     |
| 6         | -1     | -0.5   |

```{r, attitude-nodelist}


nominator_data <- tibble(nominator = c(1, 2, 3, 4, 5, 6),
                time_2 = c(2, 2, 1, -0.5, -2, -0.5)
                )


```

### 2c. Create Network with Attributes

Recall from previous units that we introduced the {tidygraph} package
for preparing and summarizing our Twitter network. Tidygraph includes
the full functionality ofÂ `igraph`Â in a tidy API giving you access to
almost all of theÂ `dplyr`Â verbs plus a few more, developed for use with
relational data.

Similar to Unit 2, use the `tbl_graph()` function to convert our
`leader_edges` and `leader_nodes` data frames into a network graph
object, by including the following arguments and supplying the
appropriate code:

-   `edges =` expects a data frame, in our case `leader_edges`,
    containing information about the edges in the graph. The nodes of
    each edge must either be in a `to` and `from` column, or in the two
    first columns like the data frame we provided.

-   `nodes =` expects a data frame, in our case `leader_nodes`,
    containing information about the nodes in the graph. If `to` and/or
    `from` are characters or names, like in our data frames, then they
    will be matched to the column named according to `node_key` in
    nodes, if it exists, or matched to the first column in the node
    list.

-   `directed =` specifies whether the constructed graph be directed.

```{r create-network}
# YOUR CODE HERE
student_network <- tbl_graph(edges = student_edges,
                         nodes = nominee_data,
                         directed = TRUE)


student_network
```

Congrats! You made it to the end of data wrangling section and are ready
to start analysis!

------------------------------------------------------------------------

## 3. EXPLORE

In Section 3, we use the {tidygraph} package for retrieving network
descriptives and the {ggraph} package to create a network visualization
to help illustrate these metrics. Specifically, in this section we will:

a.  **Examine Basic Descriptives**. We focus primarily on actors and
    edges in this walkthrough, including whether or not ties were
    reciprocated and node degree, an important and fairly intuitive
    measure of centrality.

b.  **Make a Sociogram**. Finally, we wrap up the explore phases by
    learning to plot a network and tweak key elements like the size,
    shape, and position of nodes and edges to better at communicating
    key findings.

### 3a. Examine Descriptives

As noted in SNA and Education [@carolan2014], many analyses of social
networks are primarily descriptive and aim to either represent the
network's underlying social structure through data-reduction techniques
or to characterize network properties through network measures.

In the analyses described in Chapter 9, descriptives were limited to the
mean and standard deviation for: in-degree, out-degree, trust and
efficacy measures. The proportion of male leaders was also reported. For
section 3a, let's see if we can reproduce these descriptives.

#### Calculate Node Degree

Recall that **degree** is the number of ties to and from an ego, or in
the case of a "simple graph" like ours, degree is simply the number of
people to whom someone is connected. In a directed network,
**in-degree** is the number of connections or ties received, whereas
**out-degree** is the number of connections or ties sent.

The `activate()` function from the {tidygraph} package allows us to
treat the nodes in our network object as if they were a standard data
frame to which we can then apply tidyverse functions such as `select()`,
`filter()`, and `mutate()`.

We can use the `mutate()` functions to create new variables for nodes
such as measures of degree, in-degree, and out-degree using the
`centrality_degree()` function in the {tidygraph} package.

Run the following code to add in- and out-degree measures to each of our
nodes and examine the output:

```{r add-indegree}
student_network <- student_network |>
  activate(nodes) |>
  mutate(in_degree = centrality_degree(mode = "in"))

student_network
```

#### 

### 3b. Visualize Network Properties

In Chapter 9, @carolan2014 depicts a directed and dichotomous sociogram
of the **collaboration** network for year 3 is shown in .

```{r}
plot(student_network)
```

#### ðŸ‘‰ Your Turn â¤µ

Try creating a **Year 3 Confidential Exchange Network** by modifying the
code below and tweaking the included function/arguments or adding new
ones for
[layouts](https://ggraph.data-imaginist.com/articles/Layouts.html),
[nodes](https://ggraph.data-imaginist.com/articles/Nodes.html), and
[edges](https://ggraph.data-imaginist.com/articles/Edges.html) to make
our plot either more "aesthetically pleasing" or more purposeful in what
it's trying to communicate.

-   size is

```{r improve-sociogram}
#YOUR CODE HERE
student_network |>
ggraph() + 
 # geom_node_text(aes(label = nominator)) +
  geom_node_point(aes(size = in_degree,
                      color = time_1, 
                      text = nominator)) +
  geom_edge_link() + 
  theme_graph()
```

After you are satisfied with your sociogram, answer the following
questions?

1.  How is the Year 3 confidential exchange network similar to the
    collaboration network? How is it different?

    -   YOUR RESPONSE HERE

Congrats! You made it to the end of the Explore section and are ready to
learn a little ab out modeling network selection processes using ERGMs!
Before proceeding further, knit your document and check to see if you
encounter any errors.

------------------------------------------------------------------------

## 4. MODEL

Recall from @carolan2014 that

1.  **Attribute Effect.** Do a leader's gender and efficacy score,
    predict a confidential exchange between two leaders?

### 4a. Calculating an Exposure Term

Next we'll create an exposure term. This is the key step that makes this
linear regression model special. The idea is that the exposure term
"captures" how your interactions with someone over the first and second
time points impact an outcome. The model describes a change in this
outcome because it takes the first and second time points into
account.{r, eval = FALSE}

```{r}

student_data <- left_join(student_edges,
                          nominee_data,
                          by = "nominee")

student_data
```

```{r}
student_data <- left_join(student_data,
                          nominator_data,
                          by = "nominator")

student_data
```

```{r}
# Calculating exposure 
student_exposure <- student_data |>
  mutate(exposure = relate * time_1) 
# Calculating mean exposure 

mean_exposure <- student_exposure %>% 
  group_by(nominator) %>% 
  summarize(exposure_mean = mean(exposure))

mean_exposure
```

The data frame mean_exposure contains the mean of the outcome (in this
case, yvar1) for all of the individuals the nominator had a relation
with.Let's process the data more so we can add the variables
exposure_mean, yvar1, and yvar2.

```{r}
nominee_data <- nominee_data %>% 
  # rename nominee as nominator to merge these 
  rename("nominator" = "nominee") 

final_data <- left_join(mean_exposure, nominee_data, by = "nominator") 

final_data <- 
  # data3 already has nominator, so no need to change 
  left_join(final_data, nominator_data, by = "nominator") |>
  rename(student = nominator)

final_data
```

### Regression (Linear Model)

Calculating the exposure term is the most distinctive and important step
in carrying out influence models. Now, we can use a linear model to find
out how much relations - as captured by the influence term - affect some
outcome. While this code is not run here, you could run the code in this
appendix to see the results (and how changes in how the exposure term is
calculated, such as by finding the sum, instead of the mean, of each
individual's exposures, impact the results.){r, eval = FALSE}

```{r}

model1 <- lm(time_2 ~ time_1 + exposure_mean, data = final_data) 

summary(model1)

get_regression_table(model1)
```

#### ðŸ‘‰ Your Turn â¤µ

Use the code chunk below to check the model fit and diagnostics for the
model the you created in [4b. Estimate the ERGM Model]:

-   

------------------------------------------------------------------------

## 5. COMMUNICATE

For your final Your Turn, your goal is to distill our analysis from
above into a simple "data product" designed to illustrate key findings
about changes in the collaboration network over time. For the purposes
of this task, imagine that your audience consists of the developers and
facilitators of the DLT MOOC-Eds who have limited background in SNA and
adapt the following steps accordingly:

1.  **Select.** Select your ERGM analysis from above, or a new analysis
    if so motivated, that you think would be interesting or relevant for
    the target audience and that helps answer our research questions.

2.  **Polish.** Create and polish a data visualization and/or data table
    to communicate your selected findings.

3.  **Narrate.** Write a brief narrative (2-3 paragraphs) to accompany
    your visualization and/or table that includes the following:

    -   The question or questions guiding the analysis;

    -   The conclusions you've reached based on our findings;

    -   How your audience might use this information;

    -   How you might revisit or improve upon this analysis in the
        future.

### ðŸ‘‰ Your Turn â¤µ

Use the code chunk below create a polished table and/or visualization(s)
and write a brief narrative in the space that follows.

### Data Visualization or Table

```{r create_data_product}
# YOUR CODE HERE


```

### Narrative

NARRATIVE GOES HERE...

### ðŸ§¶ Knit & Check âœ…

Congratulations - you've completed the Unit 3 case study! To share your
work, click the drop down arrow next to the ball of yarn that says
"Knit" at the top of this markdown file, then select "Knit top HTML".
Assuming your code contains no errors, this will create a web page in
your Files pane that serves as a record of your work.

Once your file has been knitted, you can publish this file online using
RPubs, or share the HTML file through another means.

### References
